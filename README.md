# stripe-django-orders

## Описание функциональности
Прототип подключения платежки Stripe.
Позволяет создавать в админке Валюты, Товары, присваивать им описательную часть,
цену в валютах и налог в зависимости от предустановленных в Stripe (при первом запуске
прототип заберет некоторые возможные налоги из Stripe API).
При создании товара прототип с помощью django signals попытается создать в Stripe
соответствующий продукт и цену. Успешность этого процесса можно оценить в админке.
Если присвоение не будет успешным, повторная попытка будет произведена при попытке
покупки товара.
Так же реализован эндпоинт для работы с заказом, состоящем из нескольких товаров.

###### Для запуска необходимы docker и docker-compose
###### [Инструкции по установке докера](https://docs.docker.com/engine/install/)

Склонировать репозиторий
```bash
git clone https://github.com/jingleMyBells/stripe-django-orders.git
```

Перейти в каталог с проектом и конфигурационным файлом развертки
```bash
cd stripe-django-orders/deploy
```

Создать .env файл
```bash
cat env-example.txt > .env
```

Запустить проект
```bash
sudo docker-compose up
```
либо
```bash
sudo docker-compose -f docker-compose-alt.yml up
```

## API Endpoints:
- [GET: buy/{item_id}](http://localhost/buy/1/)
- [GET: item/{item_id}](http://localhost/item/1/)
- [GET: order/{order_id}](http://localhost/order/1/)

## Проект развернут по адресу:
```http
  http://94.198.217.113
```

#### Стэк
Python3.11.2, Django REST Framework, Stripe, Nginx, Docker, Postgres

###### Заметки:
- бонусная задача про order: модель заказа реализована с общим налогом. возможность сделать больше одного экземпляра item в рамках order не добавлялась
из-за нехватки времени
- бонусная задача про tax: предположу, что при реальном применении Stripe необходимо было бы настроить 
поведение tax_behavior каким-то определенным образом (exclusive/inclusive), согласно указанию юристов/бухгалтерии, на уровне всего магазина
либо делать это с конкретными товарами. не стал решать за бизнес:)
- бонусная задача про discount: кажется, на текущий момент скидки применимы в отношении customer'ов, но не товаров. 
и кажется, в основном для подписок. что слишком далеко выходит за рамки задачи. но вообще можно сделать вообще без оглядки на Stripe.
- бонусная задача про валюту: реализовал выбор валюты, для конкретных товаров должно работать. в случае order задача требует уточнений ТЗ:)
- на Payment Intent, к великому сожалению, не хватило времени
- цены на товары сознательно с плавающей точкой для юзера в админке, тк Stripe живет "в центах"
- прототип ждет хелсчек БД, поэтому стартует с небольшой паузой (5 с.). иногда это продуцирует проблему. альтернативный запуск:
```bash
sudo docker-compose -f docker-compose-alt.yml up
```


